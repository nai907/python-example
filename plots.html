<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPVC Prediction Online Platform</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='icon.ico') }}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <a href="/" class="btn btn-secondary btn-back">Go Back</a>
        <h1 class="text-center mb-4">Results</h1>
        <div class="table-container">
            <table class="table table-bordered table-hover">
                <thead>
                    <tr>
                        <th>Select</th>
                        <th>Created by</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Created Date</th>
                        <th>Dimensions</th>
                        <th>Details</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plot in plots %}
                    <tr>
                        <td><input type="checkbox" class="plot-checkbox" data-plot-json="{{ plot.plot_json }}" data-plot-name="{{ plot.name }}"></td>
                        <td>{{ plot.created_by }}</td>
                        <td>{{ plot.name }}</td>
                        <td>{{ plot.description }}</td>
                        <td>{{ plot.timestamp }}</td>
                        <td>{{ plot.dimensions }}</td>
                        <td><a href="{{ url_for('result_page', plot_id=plot.plot_id) }}" class="btn btn-primary">View Details</a></td>
                        <td><a href="{{ url_for('delete_plot', plot_id=plot.plot_id) }}" class="btn btn-danger">Delete</a></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <button id="compare-button" class="btn btn-primary mt-3" disabled>Compare</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('.plot-checkbox');
            const compareButton = document.getElementById('compare-button');

            function updateButtonState() {
                const checkedCount = document.querySelectorAll('.plot-checkbox:checked').length;
                compareButton.disabled = checkedCount !== 2;
            }

            checkboxes.forEach(function(checkbox) {
                checkbox.addEventListener('change', function() {
                    if (document.querySelectorAll('.plot-checkbox:checked').length > 2) {
                        this.checked = false;
                        alert('You can only select up to 2 plots.');
                    }
                    updateButtonState();
                });
            });

            compareButton.addEventListener('click', function() {
                const selectedPlots = Array.from(document.querySelectorAll('.plot-checkbox:checked'))
                    .map(checkbox => ({
                        json: checkbox.getAttribute('data-plot-json'),
                        name: checkbox.getAttribute('data-plot-name')
                    }));

                if (selectedPlots.length === 2) {
                    // Create a form and submit the plot data to the /compare route
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = "{{ url_for('compare') }}";
                    
                    selectedPlots.forEach((plot, index) => {
                        const jsonInput = document.createElement('input');
                        jsonInput.type = 'hidden';
                        jsonInput.name = `plot${index + 1}`;
                        jsonInput.value = plot.json;
                        form.appendChild(jsonInput);

                        const nameInput = document.createElement('input');
                        nameInput.type = 'hidden';
                        nameInput.name = `plot${index + 1}_name`;
                        nameInput.value = plot.name;
                        form.appendChild(nameInput);
                    });

                    document.body.appendChild(form);
                    form.submit();
                }
            });
        });
    </script>
</body>
</html>
